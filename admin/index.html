<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>لوحة التحكم - Technology KSA</title>
  <link rel="stylesheet" href="../assets/css/main.css">
  <link rel="stylesheet" href="../assets/css/rtl.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --saudi-green: #0C4A2F;
      --saudi-green-light: #10B981;
      --gold: #C5A572;
      --tech-blue: #0066FF;
      --bg-primary: #ffffff;
      --bg-secondary: #f8f9fa;
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --border-color: #e5e7eb;
      --error: #ef4444;
      --success: #10B981;
      --warning: #f59e0b;
      --radius-md: 8px;
      --radius-lg: 12px;
      --radius-xl: 16px;
      --radius-full: 9999px;
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }

    [data-theme="dark"] {
      --bg-primary: #1f2937;
      --bg-secondary: #111827;
      --text-primary: #f9fafb;
      --text-secondary: #9ca3af;
      --border-color: #374151;
    }

    body {
      font-family: 'Tajawal', sans-serif;
      background-color: var(--bg-secondary);
      color: var(--text-primary);
    }

    .admin-container {
      display: flex;
      min-height: 100vh;
    }

    .admin-sidebar {
      width: 280px;
      background-color: var(--bg-primary);
      box-shadow: var(--shadow-lg);
      position: fixed;
      right: 0;
      top: 0;
      height: 100vh;
      overflow-y: auto;
      z-index: 50;
      display: flex;
      flex-direction: column;
    }

    .admin-logo {
      padding: 2rem;
      text-align: center;
      border-bottom: 1px solid var(--border-color);
    }

    .admin-logo h2 {
      color: var(--saudi-green);
      margin-top: 1rem;
      font-size: 1.5rem;
    }

    .admin-nav {
      flex: 1;
      padding: 1.5rem 0;
    }

    .admin-nav ul {
      list-style: none;
    }

    .admin-nav li {
      margin-bottom: 0.5rem;
    }

    .admin-nav a {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.5rem;
      color: var(--text-secondary);
      text-decoration: none;
      transition: all 0.3s;
      border-right: 3px solid transparent;
    }

    .admin-nav li.active a,
    .admin-nav a:hover {
      background-color: var(--bg-secondary);
      color: var(--saudi-green);
      border-right-color: var(--saudi-green);
    }

    .admin-main {
      flex: 1;
      margin-right: 280px;
      padding: 2rem;
      position: relative;
      z-index: 1;
    }

    .admin-header {
      background-color: var(--bg-primary);
      padding: 1.5rem 2rem;
      border-radius: var(--radius-xl);
      margin-bottom: 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow-md);
    }

    .admin-header h1 {
      margin: 0;
      font-size: 2rem;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-weight: 600;
      font-family: inherit;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background-color: var(--saudi-green);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--saudi-green-light);
    }

    .btn-secondary {
      background-color: var(--bg-secondary);
      color: var(--text-primary);
      border: 2px solid var(--border-color);
    }

    .btn-danger {
      background-color: var(--error);
      color: white;
    }

    .admin-content {
      background-color: var(--bg-primary);
      padding: 2rem;
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-md);
    }

    .admin-view {
      display: none;
    }

    .admin-view.active {
      display: block;
    }

    /* Posts Table */
    .posts-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 2rem;
    }

    .posts-table th,
    .posts-table td {
      padding: 1rem;
      text-align: right;
      border-bottom: 1px solid var(--border-color);
    }

    .posts-table th {
      background-color: var(--bg-secondary);
      font-weight: 600;
    }

    .badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: var(--radius-full);
      font-size: 0.875rem;
      font-weight: 600;
    }

    .badge-success {
      background-color: rgba(16, 185, 129, 0.1);
      color: var(--success);
    }

    .badge-warning {
      background-color: rgba(245, 158, 11, 0.1);
      color: var(--warning);
    }

    .action-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .btn-icon {
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--bg-secondary);
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-icon:hover {
      background-color: var(--saudi-green);
      color: white;
    }

    .btn-icon.btn-danger:hover {
      background-color: var(--error);
    }

    /* Media Library */
    .upload-area {
      border: 2px dashed var(--border-color);
      border-radius: var(--radius-xl);
      padding: 3rem;
      text-align: center;
      margin-bottom: 2rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    .upload-area:hover {
      border-color: var(--saudi-green);
      background-color: var(--bg-secondary);
    }

    .upload-area i {
      font-size: 4rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
    }

    .media-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
    }

    .media-item {
      position: relative;
      border-radius: var(--radius-lg);
      overflow: hidden;
      background-color: var(--bg-secondary);
      border: 2px solid var(--border-color);
    }

    .media-item img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }

    .media-item-info {
      padding: 0.75rem;
      background-color: var(--bg-primary);
    }

    .media-item-info input {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      margin-top: 0.5rem;
      font-family: inherit;
      background-color: var(--bg-secondary);
      color: var(--text-primary);
    }

    .media-item-info small {
      display: block;
      color: var(--text-secondary);
      font-size: 0.75rem;
      margin-top: 0.25rem;
      word-break: break-all;
    }

    .media-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .media-actions button {
      flex: 1;
      padding: 0.5rem;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 600;
      transition: all 0.3s;
    }

    .media-actions .btn-select {
      background-color: var(--saudi-green);
      color: white;
    }

    .media-actions .btn-delete {
      background-color: var(--error);
      color: white;
    }

    /* Modal Styles - FIXED Z-INDEX */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 99999;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .modal.active {
      display: flex;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 1;
    }

    .modal-content {
      position: relative;
      background-color: var(--bg-primary);
      border-radius: var(--radius-xl);
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-2xl);
      z-index: 10;
    }

    .modal-header {
      padding: 1.5rem 2rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background-color: var(--bg-primary);
      z-index: 20;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 1.5rem;
    }

    .modal-close {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      border-radius: var(--radius-full);
      color: var(--text-secondary);
    }

    .modal-close:hover {
      background-color: var(--bg-secondary);
      color: var(--error);
    }

    .modal-body {
      padding: 2rem;
    }

    .modal-footer {
      padding: 1.5rem 2rem;
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
      position: sticky;
      bottom: 0;
      background-color: var(--bg-primary);
      z-index: 20;
    }

    /* Form Styles */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid var(--border-color);
      border-radius: var(--radius-md);
      font-family: inherit;
      font-size: 1rem;
      color: var(--text-primary);
      background-color: var(--bg-secondary);
      transition: border-color 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--saudi-green);
    }

    .form-group textarea {
      min-height: 200px;
      resize: vertical;
    }

    .form-group small {
      display: block;
      margin-top: 0.25rem;
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    .featured-image-preview {
      margin-top: 1rem;
      padding: 1rem;
      border: 2px solid var(--border-color);
      border-radius: var(--radius-lg);
      background-color: var(--bg-secondary);
    }

    .featured-image-preview img {
      width: 100%;
      max-width: 400px;
      height: auto;
      border-radius: var(--radius-md);
      margin-bottom: 1rem;
    }

    .featured-image-preview .image-url {
      display: block;
      padding: 0.5rem;
      background-color: var(--bg-primary);
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      color: var(--text-secondary);
      word-break: break-all;
      margin-bottom: 0.5rem;
    }

    .image-actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn-change-image,
    .btn-remove-image {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-weight: 600;
      font-size: 0.875rem;
    }

    .btn-change-image {
      background-color: var(--saudi-green);
      color: white;
    }

    .btn-remove-image {
      background-color: var(--error);
      color: white;
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 2rem;
      left: 2rem;
      background-color: var(--saudi-green);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      z-index: 999999;
      display: none;
      align-items: center;
      gap: 1rem;
      animation: slideIn 0.3s ease;
    }

    .toast.show {
      display: flex;
    }

    .toast.error {
      background-color: var(--error);
    }

    @keyframes slideIn {
      from {
        transform: translateX(-100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @media (max-width: 768px) {
      .admin-sidebar {
        transform: translateX(100%);
        transition: transform 0.3s;
      }

      .admin-sidebar.open {
        transform: translateX(0);
      }

      .admin-main {
        margin-right: 0;
      }
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <!-- Sidebar -->
    <aside class="admin-sidebar">
      <div class="admin-logo">
        <i class="fas fa-code" style="font-size: 2.5rem; color: var(--saudi-green);"></i>
        <h2>لوحة التحكم</h2>
      </div>

      <nav class="admin-nav">
        <ul>
          <li class="active"><a href="#" data-view="posts"><i class="fas fa-file-alt"></i> المقالات</a></li>
          <li><a href="#" data-view="services"><i class="fas fa-briefcase"></i> الخدمات</a></li>
          <li><a href="#" data-view="projects"><i class="fas fa-folder-open"></i> المشاريع</a></li>
          <li><a href="#" data-view="media"><i class="fas fa-images"></i> مكتبة الصور</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
      <div class="admin-header">
        <h1 id="pageTitle">إدارة المدونة</h1>
        <button class="btn btn-primary" id="btnNewPost">
          <i class="fas fa-plus"></i> <span id="btnNewText">إضافة مقال جديد</span>
        </button>
      </div>

      <div class="admin-content">
        <!-- Posts View -->
        <div id="postsView" class="admin-view active">
          <table class="posts-table" id="postsTable">
            <thead>
              <tr>
                <th>العنوان</th>
                <th>التصنيف</th>
                <th>التاريخ</th>
                <th>الحالة</th>
                <th>الإجراءات</th>
              </tr>
            </thead>
            <tbody id="postsTableBody">
              <!-- Posts will be inserted here -->
            </tbody>
          </table>
        </div>

        <!-- Services View -->
        <div id="servicesView" class="admin-view">
          <table class="posts-table" id="servicesTable">
            <thead>
              <tr>
                <th>اسم الخدمة</th>
                <th>Slug</th>
                <th>الحالة</th>
                <th>الإجراءات</th>
              </tr>
            </thead>
            <tbody id="servicesTableBody">
              <!-- Services will be inserted here -->
            </tbody>
          </table>
        </div>

        <!-- Projects View -->
        <div id="projectsView" class="admin-view">
          <table class="posts-table" id="projectsTable">
            <thead>
              <tr>
                <th>عنوان المشروع</th>
                <th>التصنيف</th>
                <th>العميل</th>
                <th>التاريخ</th>
                <th>الإجراءات</th>
              </tr>
            </thead>
            <tbody id="projectsTableBody">
              <!-- Projects will be inserted here -->
            </tbody>
          </table>
        </div>

        <!-- Media View -->
        <div id="mediaView" class="admin-view">
          <div class="upload-area" id="uploadArea">
            <div class="upload-content">
              <i class="fas fa-cloud-upload-alt"></i>
              <h3>رفع الصور</h3>
              <p>اسحب وأفلت الصور هنا أو اضغط للاختيار</p>
              <input type="file" id="fileInput" accept="image/*" multiple style="display: none;">
              <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                <i class="fas fa-upload"></i> اختر الصور
              </button>
            </div>
          </div>

          <div class="media-grid" id="mediaGrid">
            <!-- Media items will be inserted here -->
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Post Editor Modal -->
  <div id="postModal" class="modal">
    <div class="modal-overlay" onclick="closePostModal()"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">إضافة مقال جديد</h3>
        <button class="modal-close" onclick="closePostModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <form id="postForm">
          <input type="hidden" id="postId">

          <div class="form-group">
            <label for="postTitle">عنوان المقال <span style="color: var(--error);">*</span></label>
            <input type="text" id="postTitle" required placeholder="أدخل عنوان المقال">
            <small>سيتم توليد الـ slug والـ alt text تلقائياً من العنوان</small>
          </div>

          <div class="form-group">
            <label for="postSlug">Slug</label>
            <input type="text" id="postSlug" placeholder="سيتم التوليد تلقائياً">
            <small>رابط المقال (يتم توليده تلقائياً من العنوان)</small>
          </div>

          <div class="form-group">
            <label for="postCategory">التصنيف <span style="color: var(--error);">*</span></label>
            <select id="postCategory" required>
              <option value="">اختر التصنيف</option>
              <option value="تسويق رقمي">تسويق رقمي</option>
              <option value="تطوير ويب">تطوير ويب</option>
              <option value="تطبيقات جوال">تطبيقات جوال</option>
              <option value="أمن سيبراني">أمن سيبراني</option>
              <option value="تقنية">تقنية</option>
              <option value="استشارات">استشارات</option>
            </select>
          </div>

          <div class="form-group">
            <label>الصورة المميزة</label>
            <button type="button" class="btn btn-secondary" onclick="openImageSelector()">
              <i class="fas fa-image"></i> اختيار صورة من المكتبة
            </button>
            <div id="featuredImagePreview" style="display: none;" class="featured-image-preview">
              <img id="previewImage" src="" alt="">
              <small style="font-weight: 600; color: var(--text-primary); display: block; margin-bottom: 0.5rem;">رابط الصورة:</small>
              <span class="image-url" id="imageUrl"></span>
              <div class="form-group" style="margin-bottom: 0.5rem;">
                <label for="imageAlt">Alt Text للصورة</label>
                <input type="text" id="imageAlt" placeholder="وصف الصورة">
              </div>
              <div class="image-actions">
                <button type="button" class="btn-change-image" onclick="openImageSelector()">
                  <i class="fas fa-sync"></i> تغيير الصورة
                </button>
                <button type="button" class="btn-remove-image" onclick="removeFeaturedImage()">
                  <i class="fas fa-trash"></i> حذف الصورة
                </button>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="postExcerpt">المقتطف</label>
            <textarea id="postExcerpt" rows="3" placeholder="ملخص قصير للمقال"></textarea>
          </div>

          <div class="form-group">
            <label for="postContent">محتوى المقال <span style="color: var(--error);">*</span></label>
            <textarea id="postContent" required placeholder="اكتب محتوى المقال هنا..."></textarea>
          </div>

          <div class="form-group">
            <label for="metaTitle">عنوان Meta</label>
            <input type="text" id="metaTitle" placeholder="عنوان الصفحة للسيو">
          </div>

          <div class="form-group">
            <label for="metaDescription">وصف Meta</label>
            <textarea id="metaDescription" rows="2" placeholder="وصف الصفحة للسيو"></textarea>
          </div>

          <div class="form-group">
            <label for="postAuthor">الكاتب</label>
            <input type="text" id="postAuthor" value="فريق تكنولوجي السعودية" placeholder="اسم الكاتب">
          </div>

          <div class="form-group">
            <label for="postStatus">حالة المقال <span style="color: var(--error);">*</span></label>
            <select id="postStatus" required>
              <option value="published">منشور</option>
              <option value="draft">مسودة</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closePostModal()">إلغاء</button>
        <button type="button" class="btn btn-primary" onclick="savePost()">
          <i class="fas fa-save"></i> حفظ المقال
        </button>
      </div>
    </div>
  </div>

  <!-- Service Editor Modal -->
  <div id="serviceModal" class="modal">
    <div class="modal-overlay" onclick="closeServiceModal()"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="serviceModalTitle">إضافة خدمة جديدة</h3>
        <button class="modal-close" onclick="closeServiceModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <form id="serviceForm">
          <input type="hidden" id="serviceId">

          <div class="form-group">
            <label for="serviceName">اسم الخدمة <span style="color: var(--error);">*</span></label>
            <input type="text" id="serviceName" required placeholder="مثال: تطوير المواقع">
          </div>

          <div class="form-group">
            <label for="serviceSlug">Slug</label>
            <input type="text" id="serviceSlug" placeholder="web-development">
            <small>سيتم التوليد تلقائياً من الاسم</small>
          </div>

          <div class="form-group">
            <label for="serviceIcon">أيقونة Font Awesome</label>
            <input type="text" id="serviceIcon" placeholder="fas fa-code">
            <small>مثال: fas fa-code, fas fa-mobile-alt</small>
          </div>

          <div class="form-group">
            <label for="serviceDescription">الوصف المختصر <span style="color: var(--error);">*</span></label>
            <textarea id="serviceDescription" rows="3" required placeholder="وصف قصير عن الخدمة"></textarea>
          </div>

          <div class="form-group">
            <label for="serviceContent">المحتوى الكامل <span style="color: var(--error);">*</span></label>
            <textarea id="serviceContent" required placeholder="تفاصيل الخدمة الكاملة"></textarea>
          </div>

          <div class="form-group">
            <label>الصورة المميزة</label>
            <button type="button" class="btn btn-secondary" onclick="openImageSelectorForService()">
              <i class="fas fa-image"></i> اختيار صورة من المكتبة
            </button>
            <div id="serviceFeaturedImagePreview" style="display: none;" class="featured-image-preview">
              <img id="servicePreviewImage" src="" alt="">
              <div class="image-actions">
                <button type="button" class="btn-change-image" onclick="openImageSelectorForService()">
                  <i class="fas fa-sync"></i> تغيير الصورة
                </button>
                <button type="button" class="btn-remove-image" onclick="removeServiceFeaturedImage()">
                  <i class="fas fa-trash"></i> حذف الصورة
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeServiceModal()">إلغاء</button>
        <button type="button" class="btn btn-primary" onclick="saveService()">
          <i class="fas fa-save"></i> حفظ الخدمة
        </button>
      </div>
    </div>
  </div>

  <!-- Project Editor Modal -->
  <div id="projectModal" class="modal">
    <div class="modal-overlay" onclick="closeProjectModal()"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="projectModalTitle">إضافة مشروع جديد</h3>
        <button class="modal-close" onclick="closeProjectModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <form id="projectForm">
          <input type="hidden" id="projectId">

          <div class="form-group">
            <label for="projectTitle">عنوان المشروع <span style="color: var(--error);">*</span></label>
            <input type="text" id="projectTitle" required placeholder="مثال: منصة تجارة إلكترونية متكاملة">
          </div>

          <div class="form-group">
            <label for="projectSlug">Slug</label>
            <input type="text" id="projectSlug" placeholder="ecommerce-platform">
            <small>سيتم التوليد تلقائياً من العنوان</small>
          </div>

          <div class="form-group">
            <label for="projectCategory">التصنيف <span style="color: var(--error);">*</span></label>
            <select id="projectCategory" required>
              <option value="">اختر التصنيف</option>
              <option value="مواقع">مواقع إلكترونية</option>
              <option value="تطبيقات">تطبيقات جوال</option>
              <option value="هوية">هوية تجارية</option>
              <option value="تجارة">تجارة إلكترونية</option>
              <option value="تصميم">تصميم</option>
            </select>
          </div>

          <div class="form-group">
            <label for="projectDescription">الوصف المختصر <span style="color: var(--error);">*</span></label>
            <textarea id="projectDescription" rows="3" required placeholder="وصف مختصر عن المشروع"></textarea>
          </div>

          <div class="form-group">
            <label for="projectClient">اسم العميل</label>
            <input type="text" id="projectClient" placeholder="مثال: شركة التجارة الحديثة">
          </div>

          <div class="form-group">
            <label for="projectDate">تاريخ المشروع <span style="color: var(--error);">*</span></label>
            <input type="date" id="projectDate" required>
          </div>

          <div class="form-group">
            <label for="projectDuration">مدة التنفيذ</label>
            <input type="text" id="projectDuration" placeholder="مثال: 6 أشهر">
          </div>

          <div class="form-group">
            <label for="projectTags">التقنيات المستخدمة (افصل بفاصلة)</label>
            <input type="text" id="projectTags" placeholder="React, Node.js, MongoDB">
            <small>افصل التقنيات بفاصلة</small>
          </div>

          <div class="form-group">
            <label>صورة المشروع</label>
            <button type="button" class="btn btn-secondary" onclick="openImageSelectorForProject()">
              <i class="fas fa-image"></i> اختيار صورة من المكتبة
            </button>
            <div id="projectFeaturedImagePreview" style="display: none;" class="featured-image-preview">
              <img id="projectPreviewImage" src="" alt="">
              <div class="image-actions">
                <button type="button" class="btn-change-image" onclick="openImageSelectorForProject()">
                  <i class="fas fa-sync"></i> تغيير الصورة
                </button>
                <button type="button" class="btn-remove-image" onclick="removeProjectFeaturedImage()">
                  <i class="fas fa-trash"></i> حذف الصورة
                </button>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="projectContent">تفاصيل المشروع الكاملة</label>
            <textarea id="projectContent" rows="5" placeholder="اكتب تفاصيل المشروع والتحديات والحلول..."></textarea>
          </div>

          <div class="form-group">
            <label for="projectFeatures">المميزات الرئيسية (واحدة في كل سطر)</label>
            <textarea id="projectFeatures" rows="5" placeholder="واجهة مستخدم حديثة&#10;نظام إدارة متقدم&#10;تكامل مع بوابات الدفع"></textarea>
            <small>اكتب كل ميزة في سطر منفصل</small>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeProjectModal()">إلغاء</button>
        <button type="button" class="btn btn-primary" onclick="saveProject()">
          <i class="fas fa-save"></i> حفظ المشروع
        </button>
      </div>
    </div>
  </div>

  <!-- Image Selector Modal -->
  <div id="imageSelectorModal" class="modal">
    <div class="modal-overlay" onclick="closeImageSelector()"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>اختيار صورة</h3>
        <button class="modal-close" onclick="closeImageSelector()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="media-grid" id="imageSelectorGrid">
          <!-- Images will be inserted here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast">
    <i class="fas fa-check-circle"></i>
    <span id="toastMessage"></span>
  </div>

  <script src="../assets/js/admin.js"></script>
  <script>
    // Initialize Admin Panel
    let blogCMS;
    let currentImageTarget = 'post'; // 'post' or 'service'

    document.addEventListener('DOMContentLoaded', function() {
      blogCMS = new BlogCMS();
      blogCMS.init();

      // Navigation
      document.querySelectorAll('.admin-nav a').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const view = this.dataset.view;

          // Update active nav
          document.querySelectorAll('.admin-nav li').forEach(li => li.classList.remove('active'));
          this.parentElement.classList.add('active');

          // Show view
          document.querySelectorAll('.admin-view').forEach(v => v.classList.remove('active'));
          document.getElementById(view + 'View').classList.add('active');

          // Update header
          const pageTitle = document.getElementById('pageTitle');
          const btnNewPost = document.getElementById('btnNewPost');
          const btnNewText = document.getElementById('btnNewText');

          if (view === 'posts') {
            pageTitle.textContent = 'إدارة المدونة';
            btnNewText.textContent = 'إضافة مقال جديد';
            btnNewPost.onclick = openPostModal;
          } else if (view === 'services') {
            pageTitle.textContent = 'إدارة الخدمات';
            btnNewText.textContent = 'إضافة خدمة جديدة';
            btnNewPost.onclick = openServiceModal;
          } else if (view === 'projects') {
            pageTitle.textContent = 'إدارة المشاريع';
            btnNewText.textContent = 'إضافة مشروع جديد';
            btnNewPost.onclick = openProjectModal;
          } else if (view === 'media') {
            pageTitle.textContent = 'مكتبة الصور';
            btnNewPost.style.display = 'none';
          }

          if (view !== 'media') {
            btnNewPost.style.display = 'flex';
          }
        });
      });

      // New Post Button
      document.getElementById('btnNewPost').addEventListener('click', function() {
        openPostModal();
      });

      // File Upload
      const fileInput = document.getElementById('fileInput');
      const uploadArea = document.getElementById('uploadArea');

      fileInput.addEventListener('change', function(e) {
        handleFiles(e.target.files);
      });

      uploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        uploadArea.classList.add('dragover');
      });

      uploadArea.addEventListener('dragleave', function() {
        uploadArea.classList.remove('dragover');
      });

      uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        handleFiles(e.dataTransfer.files);
      });

      // Auto-generate slug from title (posts)
      document.getElementById('postTitle').addEventListener('input', function() {
        const title = this.value;
        const slug = blogCMS.generateSlug(title);
        document.getElementById('postSlug').value = slug;

        if (!document.getElementById('imageAlt').value) {
          document.getElementById('imageAlt').value = title;
        }
      });

      // Auto-generate slug from service name
      document.getElementById('serviceName').addEventListener('input', function() {
        const name = this.value;
        const slug = blogCMS.generateSlug(name);
        document.getElementById('serviceSlug').value = slug;
      });

      // Auto-generate slug from project title
      document.getElementById('projectTitle').addEventListener('input', function() {
        const title = this.value;
        const slug = blogCMS.generateSlug(title);
        document.getElementById('projectSlug').value = slug;
      });
    });

    function handleFiles(files) {
      Array.from(files).forEach(file => {
        if (file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = function(e) {
            blogCMS.uploadImage(file.name, e.target.result);
          };
          reader.readAsDataURL(file);
        }
      });
    }

    // === POST FUNCTIONS ===
    function openPostModal(postId = null) {
      const modal = document.getElementById('postModal');
      const form = document.getElementById('postForm');
      form.reset();

      if (postId) {
        const post = blogCMS.posts.find(p => p.id === postId);
        if (post) {
          document.getElementById('modalTitle').textContent = 'تعديل المقال';
          document.getElementById('postId').value = post.id;
          document.getElementById('postTitle').value = post.title;
          document.getElementById('postSlug').value = post.slug;
          document.getElementById('postCategory').value = post.category;
          document.getElementById('postExcerpt').value = post.excerpt;
          document.getElementById('postContent').value = post.content;
          document.getElementById('metaTitle').value = post.metaTitle;
          document.getElementById('metaDescription').value = post.metaDescription;
          document.getElementById('postAuthor').value = post.author;
          document.getElementById('postStatus').value = post.status;

          if (post.featuredImage) {
            showImagePreview(post.featuredImage, post.imageAlt || post.title);
          }
        }
      } else {
        document.getElementById('modalTitle').textContent = 'إضافة مقال جديد';
        document.getElementById('featuredImagePreview').style.display = 'none';
      }

      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closePostModal() {
      const modal = document.getElementById('postModal');
      modal.classList.remove('active');
      document.body.style.overflow = '';
    }

    function openImageSelector() {
      currentImageTarget = 'post';
      const modal = document.getElementById('imageSelectorModal');
      const grid = document.getElementById('imageSelectorGrid');

      grid.innerHTML = '';

      blogCMS.media.forEach(item => {
        const div = document.createElement('div');
        div.className = 'media-item';
        div.innerHTML = `
          <img src="${item.url}" alt="${item.alt || item.name}">
          <div class="media-item-info">
            <button class="btn btn-primary" style="width: 100%;" onclick="selectImage('${item.id}')">
              <i class="fas fa-check"></i> اختيار
            </button>
          </div>
        `;
        grid.appendChild(div);
      });

      modal.classList.add('active');
    }

    function closeImageSelector() {
      const modal = document.getElementById('imageSelectorModal');
      modal.classList.remove('active');
    }

    function selectImage(imageId) {
      const image = blogCMS.media.find(m => m.id === imageId);
      if (image) {
        if (currentImageTarget === 'post') {
          const postTitle = document.getElementById('postTitle').value || 'صورة المقال';
          showImagePreview(image.url, image.alt || postTitle);
        } else if (currentImageTarget === 'service') {
          showServiceImagePreview(image.url);
        } else if (currentImageTarget === 'project') {
          showProjectImagePreview(image.url);
        }
        closeImageSelector();
      }
    }

    function showImagePreview(url, alt) {
      document.getElementById('featuredImagePreview').style.display = 'block';
      document.getElementById('previewImage').src = url;
      document.getElementById('imageUrl').textContent = url;
      document.getElementById('imageAlt').value = alt;
    }

    function removeFeaturedImage() {
      document.getElementById('featuredImagePreview').style.display = 'none';
      document.getElementById('previewImage').src = '';
      document.getElementById('imageUrl').textContent = '';
      document.getElementById('imageAlt').value = '';
    }

    function savePost() {
      const form = document.getElementById('postForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const postData = {
        id: document.getElementById('postId').value || Date.now().toString(),
        title: document.getElementById('postTitle').value,
        slug: document.getElementById('postSlug').value,
        category: document.getElementById('postCategory').value,
        excerpt: document.getElementById('postExcerpt').value,
        content: document.getElementById('postContent').value,
        featuredImage: document.getElementById('previewImage').src || '',
        imageAlt: document.getElementById('imageAlt').value,
        metaTitle: document.getElementById('metaTitle').value,
        metaDescription: document.getElementById('metaDescription').value,
        author: document.getElementById('postAuthor').value,
        status: document.getElementById('postStatus').value,
        date: new Date().toISOString().split('T')[0],
        readTime: Math.ceil(document.getElementById('postContent').value.split(' ').length / 200)
      };

      if (document.getElementById('postId').value) {
        blogCMS.updatePost(postData);
      } else {
        blogCMS.createPost(postData);
      }

      closePostModal();
    }

    function editPost(postId) {
      openPostModal(postId);
    }

    function deletePost(postId) {
      if (confirm('هل أنت متأكد من حذف هذا المقال؟')) {
        blogCMS.deletePost(postId);
      }
    }

    // === SERVICE FUNCTIONS ===
    function openServiceModal(serviceId = null) {
      const modal = document.getElementById('serviceModal');
      const form = document.getElementById('serviceForm');
      form.reset();

      if (serviceId) {
        const service = blogCMS.services.find(s => s.id === serviceId);
        if (service) {
          document.getElementById('serviceModalTitle').textContent = 'تعديل الخدمة';
          document.getElementById('serviceId').value = service.id;
          document.getElementById('serviceName').value = service.name;
          document.getElementById('serviceSlug').value = service.slug;
          document.getElementById('serviceIcon').value = service.icon;
          document.getElementById('serviceDescription').value = service.description;
          document.getElementById('serviceContent').value = service.content;

          if (service.featuredImage) {
            showServiceImagePreview(service.featuredImage);
          }
        }
      } else {
        document.getElementById('serviceModalTitle').textContent = 'إضافة خدمة جديدة';
        document.getElementById('serviceFeaturedImagePreview').style.display = 'none';
      }

      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeServiceModal() {
      const modal = document.getElementById('serviceModal');
      modal.classList.remove('active');
      document.body.style.overflow = '';
    }

    function openImageSelectorForService() {
      currentImageTarget = 'service';
      openImageSelector();
    }

    function showServiceImagePreview(url) {
      document.getElementById('serviceFeaturedImagePreview').style.display = 'block';
      document.getElementById('servicePreviewImage').src = url;
    }

    function removeServiceFeaturedImage() {
      document.getElementById('serviceFeaturedImagePreview').style.display = 'none';
      document.getElementById('servicePreviewImage').src = '';
    }

    function saveService() {
      const form = document.getElementById('serviceForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const serviceData = {
        id: document.getElementById('serviceId').value || Date.now().toString(),
        name: document.getElementById('serviceName').value,
        slug: document.getElementById('serviceSlug').value,
        icon: document.getElementById('serviceIcon').value,
        description: document.getElementById('serviceDescription').value,
        content: document.getElementById('serviceContent').value,
        featuredImage: document.getElementById('servicePreviewImage').src || ''
      };

      if (document.getElementById('serviceId').value) {
        blogCMS.updateService(serviceData);
      } else {
        blogCMS.createService(serviceData);
      }

      closeServiceModal();
    }

    function editService(serviceId) {
      openServiceModal(serviceId);
    }

    function deleteService(serviceId) {
      if (confirm('هل أنت متأكد من حذف هذه الخدمة؟')) {
        blogCMS.deleteService(serviceId);
      }
    }

    // === PROJECT FUNCTIONS ===
    function openProjectModal(projectId = null) {
      const modal = document.getElementById('projectModal');
      const form = document.getElementById('projectForm');
      form.reset();

      if (projectId) {
        const project = blogCMS.projects.find(p => p.id === projectId);
        if (project) {
          document.getElementById('projectModalTitle').textContent = 'تعديل المشروع';
          document.getElementById('projectId').value = project.id;
          document.getElementById('projectTitle').value = project.title;
          document.getElementById('projectSlug').value = project.slug;
          document.getElementById('projectCategory').value = project.category;
          document.getElementById('projectDescription').value = project.description;
          document.getElementById('projectClient').value = project.client || '';
          document.getElementById('projectDate').value = project.date;
          document.getElementById('projectDuration').value = project.duration || '';
          document.getElementById('projectTags').value = project.tags ? project.tags.join(', ') : '';
          document.getElementById('projectContent').value = project.content || '';
          document.getElementById('projectFeatures').value = project.features ? project.features.join('\n') : '';

          if (project.image) {
            showProjectImagePreview(project.image);
          }
        }
      } else {
        document.getElementById('projectModalTitle').textContent = 'إضافة مشروع جديد';
        document.getElementById('projectFeaturedImagePreview').style.display = 'none';
        // Set default date to today
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('projectDate').value = today;
      }

      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeProjectModal() {
      const modal = document.getElementById('projectModal');
      modal.classList.remove('active');
      document.body.style.overflow = '';
    }

    function openImageSelectorForProject() {
      currentImageTarget = 'project';
      openImageSelector();
    }

    function showProjectImagePreview(url) {
      document.getElementById('projectFeaturedImagePreview').style.display = 'block';
      document.getElementById('projectPreviewImage').src = url;
    }

    function removeProjectFeaturedImage() {
      document.getElementById('projectFeaturedImagePreview').style.display = 'none';
      document.getElementById('projectPreviewImage').src = '';
    }

    function saveProject() {
      const form = document.getElementById('projectForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      // Parse tags
      const tagsInput = document.getElementById('projectTags').value;
      const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(t => t) : [];

      // Parse features
      const featuresInput = document.getElementById('projectFeatures').value;
      const features = featuresInput ? featuresInput.split('\n').map(f => f.trim()).filter(f => f) : [];

      const projectData = {
        id: document.getElementById('projectId').value || Date.now().toString(),
        title: document.getElementById('projectTitle').value,
        slug: document.getElementById('projectSlug').value,
        category: document.getElementById('projectCategory').value,
        description: document.getElementById('projectDescription').value,
        client: document.getElementById('projectClient').value,
        date: document.getElementById('projectDate').value,
        duration: document.getElementById('projectDuration').value,
        tags: tags,
        image: document.getElementById('projectPreviewImage').src || '',
        content: document.getElementById('projectContent').value,
        features: features
      };

      if (document.getElementById('projectId').value) {
        blogCMS.updateProject(projectData);
      } else {
        blogCMS.createProject(projectData);
      }

      closeProjectModal();
    }

    function editProject(projectId) {
      openProjectModal(projectId);
    }

    function deleteProject(projectId) {
      if (confirm('هل أنت متأكد من حذف هذا المشروع؟')) {
        blogCMS.deleteProject(projectId);
      }
    }

    // === MEDIA FUNCTIONS ===
    function deleteMedia(mediaId) {
      if (confirm('هل أنت متأكد من حذف هذه الصورة؟')) {
        blogCMS.deleteMedia(mediaId);
      }
    }

    function updateImageAlt(imageId, alt) {
      blogCMS.updateImageAlt(imageId, alt);
    }
  </script>
</body>
</html>
